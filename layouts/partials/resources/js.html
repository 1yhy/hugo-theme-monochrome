{{/*  Header  */}}
{{ $bundle := slice (resources.Get "js/header.js") }}

{{/*  Zooming.js  */}}
{{ if (.Scratch.Get "params").enableZoomingJS }}
    {{ $bundle = $bundle | append (resources.Get "js/zooming.js") }}
{{ end }}

{{/*  Multilingual.js  */}}
{{ if .Site.IsMultiLingual }}
    {{ $bundle = $bundle | append (resources.Get "js/multilingual.js") }}
{{ end }}

{{/* MathJax */}}
{{ if (.Scratch.Get "params").math }}
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    {{ $bundle = $bundle | append (resources.Get "js/math.js") }}
{{ end }}

{{/*  JS Bundling  */}}
{{ $build_opts := dict "targetPath" "js/main.js" }}
{{- if hugo.IsProduction -}}
    {{ $build_opts = merge $build_opts (dict "minify" true) -}}
{{- end -}}
{{ $bundle = $bundle | resources.Concat "js/bundle.js" | js.Build $build_opts | resources.Fingerprint "sha512" }}
<script src="{{ $bundle.RelPermalink }}" integrity="{{- $bundle.Data.Integrity -}}"></script>

{{/*  Load Site Index Data (Multilingual)  */}}
{{ if (.Scratch.Get "params").enableSiteSearch }}
    {{ $target_path := printf "js/search-%s.js" .Site.LanguageCode }}
    {{ $index_url := "index.json" | absLangURL }}
    {{ $build_opts := dict "targetPath" $target_path "params" (dict "index_url" $index_url) }}
    {{- if hugo.IsProduction -}}
        {{ $build_opts = merge $build_opts (dict "minify" true) -}}
    {{- end -}}
    {{ $search_js := resources.Get "js/search.js" | js.Build $build_opts | resources.Fingerprint "sha512" }}
    <script src="{{ $search_js.RelPermalink }}" integrity="{{- $search_js.Data.Integrity -}}"></script>
{{ end }}

{{/*  Load script for only page contain codeblock  */}}
{{ if (findRE "<pre" .Content 1) }}
    {{ if (.Scratch.Get "params").usePrismJS }}
        {{ $prism_js := resources.Get "js/prism.js" | resources.Fingerprint "sha512" }}
        <script src="{{ $prism_js.RelPermalink }}" integrity="{{- $prism_js.Data.Integrity -}}"></script>
    {{ else if (.Scratch.Get "params").enableCodeCopy }}
        {{ $build_opts := dict "targetPath" "js/code-copy-btn.js" }}
        {{- if hugo.IsProduction -}}
            {{ $build_opts = merge $build_opts (dict "minify" true) -}}
        {{- end -}}
        {{ $code_copy_js := resources.Get "js/code-copy-btn.js" | js.Build $build_opts | resources.Fingerprint "sha512" }}
        <script src="{{ $code_copy_js.RelPermalink }}" integrity="{{- $code_copy_js.Data.Integrity -}}"></script>
    {{ end }}
{{ end }}

{{/*  Google Analytics  */}}
{{ if (.Scratch.Get "params").gaCode }}
    {{ template "_internal/google_analytics_async.html" . }}
{{ end }}
